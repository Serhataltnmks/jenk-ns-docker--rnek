stage('Run SonarQube Analysis') {
    steps {
        withSonarQubeEnv('SonarQube Server') {
            sh '''
                echo "Using Java version:"
                java -version
                export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
                export PATH=$JAVA_HOME/bin:$PATH
                /opt/sonar-scanner/bin/sonar-scanner -X
            '''
        }
    }
}
